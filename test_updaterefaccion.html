<!DOCTYPE html>
<html>
<head>
    <title>Test UpdateRefaccion.ashx</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-box {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 3px;
        }
        button:hover {
            background: #0056b3;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .success {
            border-left-color: #28a745 !important;
            background: #d4edda !important;
        }
        .error {
            border-left-color: #dc3545 !important;
            background: #f8d7da !important;
        }
    </style>
</head>
<body>
    <h1>üîß Test UpdateRefaccion.ashx - Campo COMPLEMENTO</h1>

    <div class="test-box">
        <h3>Paso 1: Obtener un ID de refacci√≥n</h3>
        <p>Ingresa un ID de refacci√≥n existente en la tabla refacciones:</p>
        <input type="number" id="testId" placeholder="Ej: 1234" value="1">
        <button onclick="testComplemento()">üß™ Test Guardar Complemento</button>
    </div>

    <div class="test-box">
        <h3>Resultados del Test:</h3>
        <div id="result">Esperando prueba...</div>
    </div>

    <script>
        function testComplemento() {
            var id = document.getElementById('testId').value;
            var resultDiv = document.getElementById('result');

            if (!id) {
                resultDiv.textContent = '‚ùå Error: Debes ingresar un ID';
                resultDiv.className = 'error';
                return;
            }

            resultDiv.textContent = 'üîÑ Probando guardar complemento=1...\n';
            resultDiv.className = '';

            // Test 1: Guardar complemento=1
            console.log('üîÑ TEST 1: Guardando complemento=1 para id=' + id);
            fetch('UpdateRefaccion.ashx?id=' + id + '&field=complemento&val=1')
                .then(function(r) {
                    console.log('üì° Status:', r.status);
                    return r.json();
                })
                .then(function(data) {
                    console.log('üì¶ Data:', data);
                    var text = '=== TEST 1: Guardar complemento=1 ===\n';
                    text += 'URL: UpdateRefaccion.ashx?id=' + id + '&field=complemento&val=1\n\n';
                    text += 'Respuesta:\n' + JSON.stringify(data, null, 2) + '\n\n';

                    if (data.ok) {
                        text += '‚úÖ √âXITO: Campo complemento guardado correctamente\n';
                        text += 'Registros afectados: ' + data.rows + '\n\n';

                        // Test 2: Leer de nuevo para verificar
                        text += 'üîÑ Ahora verifica que se guard√≥ en la BD...\n';
                        text += 'Abre el modal "Hoja de Trabajo" y busca el ID ' + id + '\n';
                        text += 'Deber√≠a tener la palomita azul ‚úì en la columna C\n';

                        resultDiv.className = 'success';
                    } else {
                        text += '‚ùå ERROR: ' + data.error + '\n';
                        text += '\nPosibles causas:\n';
                        text += '1. El ID ' + id + ' no existe en la tabla refacciones\n';
                        text += '2. La columna "complemento" no existe en la tabla\n';
                        text += '3. El archivo UpdateRefaccion.ashx.vb no se recompil√≥\n';
                        resultDiv.className = 'error';
                    }

                    resultDiv.textContent = text;
                })
                .catch(function(err) {
                    console.error('‚ùå Error:', err);
                    resultDiv.textContent = '‚ùå ERROR DE RED:\n' + err.message + '\n\n';
                    resultDiv.textContent += 'Verifica que:\n';
                    resultDiv.textContent += '1. La aplicaci√≥n est√© corriendo\n';
                    resultDiv.textContent += '2. El archivo UpdateRefaccion.ashx existe\n';
                    resultDiv.textContent += '3. No hay errores en IIS\n';
                    resultDiv.className = 'error';
                });
        }
    </script>

    <div class="test-box">
        <h3>üìã Instrucciones:</h3>
        <ol>
            <li>Abre esta p√°gina en tu navegador: <code>http://localhost/LORO/test_updaterefaccion.html</code></li>
            <li>Abre la consola del navegador (F12)</li>
            <li>Ingresa un ID de refacci√≥n v√°lido (busca uno en tu tabla refacciones)</li>
            <li>Haz click en "Test Guardar Complemento"</li>
            <li>Mira los resultados en pantalla y en la consola</li>
            <li>Si dice "√âXITO", abre el modal Hoja de Trabajo y verifica que el ID tenga palomita azul</li>
        </ol>
    </div>
</body>
</html>
